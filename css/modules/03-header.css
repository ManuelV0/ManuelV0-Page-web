/* =========================================================
   03) HEADER — layout impilato, hamburger, accessibilità
   Compatibile con il componente SiteHeader che usi già.
   Classi/struttura attese:
   .main-header.main-header--stacked
     .header-brand (.brand-title)
     .mobile-nav-toggle [aria-expanded]
     nav#primary-navigation.main-nav.main-nav--centered[data-visible]
     #primary-actions.header-actions.header-actions--centered[data-visible]
   ========================================================= */

/* -----------------------------
   3.1 Wrapper header (sticky)
   ----------------------------- */
.main-header {
  position: sticky; /* resta in alto durante lo scroll */
  top: 0;
  inset-inline: 0;
  z-index: var(--z-header, 1000);
  background: var(--c-superficie);
  border-bottom: 1px solid var(--c-bordi);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

/* Variante impilata (brand sopra, poi nav, poi actions) */
.main-header--stacked {
  display: grid;
  grid-template-columns: 1fr auto 1fr; /* brand centrato, toggle a dx su mobile */
  align-items: center;
  gap: var(--s-2);
  padding: clamp(.6rem, 1.6vw, .9rem) var(--container-pad);
}

/* -----------------------------
   3.2 Brand (centrato)
   ----------------------------- */
.header-brand {
  grid-column: 1 / -1; /* riga intera su mobile */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .6rem;
  text-align: center;
}
.header-brand .brand-title {
  font-family: var(--font-heading);
  font-weight: var(--fw-extrabold);
  font-size: clamp(1.15rem, 2.1vw, 1.65rem);
  letter-spacing: .2px;
  color: var(--c-testo);
}
.header-brand i {
  color: var(--c-primario);
  font-size: 1.25em;
}

/* -----------------------------
   3.3 Toggle hamburger
   ----------------------------- */
.mobile-nav-toggle {
  grid-column: 3; /* a destra */
  justify-self: end;
  appearance: none;
  background: transparent;
  border: 1px solid var(--c-bordi);
  color: var(--c-testo);
  border-radius: 10px;
  padding: .5rem .65rem;
  font-size: 1.1rem;
  cursor: pointer;
  transition: background var(--t-quick), border-color var(--t-quick), transform var(--t-quick);
}
.mobile-nav-toggle:hover {
  background: color-mix(in srgb, var(--c-primario) 6%, transparent);
}
.mobile-nav-toggle:active {
  transform: translateY(1px);
}
.mobile-nav-toggle:focus-visible {
  outline: var(--focus-ring-width) solid var(--focus-ring-color);
  outline-offset: var(--focus-ring-offset);
}

/* -----------------------------
   3.4 Nav principale
   ----------------------------- */
.main-nav {
  grid-column: 1 / -1;
  display: none; /* chiusa di default su mobile */
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: .6rem .9rem;
  padding-block: .35rem;
}

/* Apertura/chiusura mobile guidata da data-visible (gestita da React) */
.main-nav[data-visible="true"] {
  display: flex;
}

.main-nav a,
.main-nav button {
  appearance: none;
  background: transparent;
  border: 0;
  padding: .5rem .8rem;
  font: inherit;
  color: var(--c-testo);
  border-radius: 8px;
  text-decoration: none;
  cursor: pointer;
  transition: color var(--t-quick), background var(--t-quick);
  white-space: nowrap;
}
.main-nav a:hover,
.main-nav button:hover {
  color: var(--c-primario);
  background: color-mix(in srgb, var(--c-primario) 9%, transparent);
}

/* Stato attivo coerente con il resto del sito */
.main-nav .is-active {
  color: var(--c-primario);
  text-decoration: underline;
  text-underline-offset: 4px;
}

/* -----------------------------
   3.5 Barra azioni (login/cta)
   ----------------------------- */
.header-actions {
  grid-column: 1 / -1;
  display: none; /* chiusa di default su mobile */
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: .5rem .6rem;
  padding-block: .35rem .6rem;
}
.header-actions[data-visible="true"] {
  display: flex;
}

.user-chip {
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  padding: .35rem .6rem;
  border: 1px solid var(--c-bordi);
  border-radius: 999px;
  background: var(--c-superficie);
}
.chip-email {
  font-size: .85rem;
  color: var(--c-testo-leggero);
  max-width: 38ch;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* -----------------------------
   3.6 Breakpoint: da tablet in su
   - Nav & actions sempre visibili
   - Layout in riga (brand centrato)
   ----------------------------- */
@media (min-width: 768px) {
  .main-header--stacked {
    grid-template-columns: 1fr auto 1fr; /* brand al centro, nav a sinistra, actions a destra */
    grid-auto-flow: row;
    align-items: center;
  }

  .header-brand {
    grid-column: 2; /* centro visivo */
  }
  .mobile-nav-toggle {
    display: none; /* hamburger sparisce */
  }

  .main-nav {
    grid-column: 1; /* a sinistra */
    display: flex !important;
    justify-content: flex-start;
    gap: .6rem;
  }

  .header-actions {
    grid-column: 3; /* a destra */
    display: flex !important;
    justify-content: flex-end;
    gap: .6rem;
  }

  /* dimensioni un filo più compatte su desktop */
  .main-nav a,
  .main-nav button {
    padding: .45rem .65rem;
  }
}

/* -----------------------------
   3.7 Breakpoint desktop largo
   ----------------------------- */
@media (min-width: 1024px) {
  .main-header--stacked {
    padding-block: .85rem;
  }
  .main-nav {
    gap: .75rem;
  }
}

/* -----------------------------
   3.8 Tema scuro (opzionale)
   ----------------------------- */
@media (prefers-color-scheme: dark) {
  .main-header {
    background: color-mix(in srgb, var(--c-superficie) 88%, #000);
  }
  .mobile-nav-toggle {
    border-color: color-mix(in srgb, var(--c-bordi) 60%, #000);
  }
  .user-chip {
    background: color-mix(in srgb, var(--c-superficie) 85%, #000);
  }
}