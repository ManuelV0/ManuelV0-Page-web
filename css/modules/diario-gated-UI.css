/* =========================================================
   13 — DIARIO AUTORE (Gated + Responsive)
   Prefisso: .dg-*
   Dipendenze consigliate: 01-tokens.css (variabili), 02-base.css
   Stati previsti (da React):
     - <section class="dg" data-logged-in="true|false">
     - card proprietario: .dg-card--owner (o data-owner="true")
     - card espansa: .is-open
     - griglia bloccata: .dg--locked sul wrapper o data-logged-in="false"
   ========================================================= */

/* ---------- 13.1 Wrapper & banner di stato ---------- */
.dg {
  background: var(--c-superficie);
  border: 1px solid var(--c-bordi);
  border-radius: var(--bordo-arrotondato);
  box-shadow: var(--ombra-card);
  padding: var(--spazio-md);
  margin: var(--spazio-md) auto;
  max-width: 1200px;
  display: grid;
  gap: var(--spazio-md);
}

.dg__banner {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: var(--spazio-sm);
  align-items: start;
  padding: .85rem 1rem;
  border: 1px dashed var(--c-bordi);
  border-radius: 12px;
  background: #fcfdfc;
}
.dg__banner strong { color: var(--c-primario); }
.dg__banner .dg__cta {
  display: inline-flex; align-items: center; gap: .5rem;
  padding: .5rem .9rem; border-radius: 10px; border: 1px solid var(--c-bordi);
  background: var(--c-superficie); cursor: pointer; font-weight: 700;
  transition: border-color .15s ease, color .15s ease, background .15s ease;
}
.dg__banner .dg__cta:hover { border-color: var(--c-primario); color: var(--c-primario); }

/* Nasconde il banner quando loggato */
.dg[data-logged-in="true"] .dg__banner { display: none; }

/* ---------- 13.2 Toolbar (search + filter) ---------- */
.dg__toolbar {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--spazio-sm);
}

.dg__search,
.dg__select {
  width: 100%;
  padding: .85rem .9rem;
  border: 1px solid var(--c-bordi);
  border-radius: 12px;
  background: var(--c-superficie);
  color: var(--c-testo);
  transition: border-color .15s ease, box-shadow .15s ease;
  font-size: .95rem;
}
.dg__search:focus,
.dg__select:focus {
  border-color: var(--c-primario);
  box-shadow: 0 0 0 3px rgba(76,175,80,.15);
  outline: none;
}

/* Stato locked: input non interattivi finché non loggato */
.dg[data-logged-in="false"] .dg__search,
.dg[data-logged-in="false"] .dg__select {
  pointer-events: none;
  opacity: .55;
  filter: grayscale(.25);
}

/* ---------- 13.3 Griglia carte (responsive) ---------- */
.dg-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--spazio-md);
}

/* ≥640px: 2 colonne */
@media (min-width: 640px){
  .dg-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
/* ≥1024px: 3 colonne */
@media (min-width: 1024px){
  .dg-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
/* ≥1440px: 4 colonne */
@media (min-width: 1440px){
  .dg-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}

/* ---------- 13.4 Card autore ---------- */
.dg-card {
  background: #fff;
  border: 1px solid var(--c-bordi);
  border-radius: 14px;
  box-shadow: var(--ombra-card);
  overflow: hidden;
  display: grid;
  gap: .75rem;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.dg-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 24px rgba(0,0,0,.08);
  border-color: color-mix(in oklab, currentColor 18%, transparent);
}

/* Evidenzia il profilo proprietario (own profile first) */
.dg-card--owner {
  border-color: color-mix(in oklab, var(--c-primario) 50%, transparent);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--c-primario) 22%, transparent);
  position: relative;
}
.dg-card--owner::after {
  content: 'Il tuo profilo';
  position: absolute; top: 10px; right: 10px;
  font-size: .72rem; font-weight: 800; letter-spacing: .2px;
  padding: .25rem .5rem; border-radius: 999px;
  color: #fff; background: var(--c-primario);
}

/* Header */
.dg-card__header {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: .9rem; align-items: center;
  padding: var(--spazio-md);
}
.dg-card__avatar {
  width: 56px; height: 56px; border-radius: 50%;
  border: 1px solid var(--c-bordi);
  background: #eee center/cover no-repeat;
}
.dg-card__name {
  font-family: var(--font-heading);
  font-weight: 800; font-size: 1.05rem; color: var(--c-testo);
  line-height: 1.2;
}
.dg-card__id { font-size: .8rem; color: var(--c-testo-leggero); }
.dg-badge {
  font-size: .75rem; font-weight: 700; padding: .3rem .6rem;
  border-radius: 999px; border: 1px solid var(--c-bordi);
  background: #fff; color: var(--c-testo-leggero);
}

/* Meta + link */
.dg-card__meta {
  display: flex; align-items: center; justify-content: space-between;
  gap: .75rem; padding: 0 var(--spazio-md);
}
.dg-meta__pill {
  display: inline-flex; align-items: center; gap: .4rem;
  padding: .35rem .6rem; border-radius: 999px; font-size: .82rem;
  background: #fafafa; border: 1px solid var(--c-bordi); color: var(--c-testo-leggero);
}
.dg-btn {
  padding: .5rem .85rem; border-radius: 10px; border: 1px solid var(--c-bordi);
  background: var(--c-superficie); color: var(--c-testo);
  font-weight: 700; font-size: .92rem; cursor: pointer;
  transition: background .15s ease, border-color .15s ease, color .15s ease;
}
.dg-btn:hover { border-color: var(--c-primario); color: var(--c-primario); }

/* Preview descrizione */
.dg-preview {
  padding: 0 var(--spazio-md);
  color: var(--c-testo);
}
.dg-preview__text {
  font-size: .95rem; line-height: 1.6;
  color: var(--c-testo);
}

/* Footer + QR */
.dg-card__footer {
  display: flex; align-items: center; justify-content: space-between;
  gap: .75rem; padding: var(--spazio-md);
}
.dg-actions { display: flex; gap: .5rem; flex-wrap: wrap; }
.dg-qr {
  width: 48px; height: 48px; border-radius: 6px;
  background: #f2f2f2 center/cover no-repeat;
  border: 1px solid var(--c-bordi);
}

/* Dettagli collassabili */
.dg-details {
  border-top: 1px solid var(--c-bordi);
  max-height: 0; opacity: 0; overflow: hidden;
  transition: max-height .28s ease, opacity .2s ease;
}
.dg-details.is-open {
  max-height: 800px; opacity: 1;
}
.dg-details__inner { padding: var(--spazio-md); display: grid; gap: .9rem; }
.dg-block h4 {
  font-family: var(--font-heading); font-weight: 800; color: var(--c-primario);
  font-size: 1rem; margin-bottom: .25rem;
}
.dg-tags { display: flex; flex-wrap: wrap; gap: .45rem; }
.dg-tag {
  font-size: .78rem; padding: .25rem .55rem; border: 1px solid var(--c-bordi);
  border-radius: 999px; background: #fff; color: var(--c-testo-leggero);
}

/* ---------- 13.5 Stati (vuoto/errore/scheletro) ---------- */
.dg-empty, .dg-error {
  display: grid; place-items: center;
  min-height: 140px; border: 2px dashed var(--c-bordi);
  border-radius: 12px; color: var(--c-testo-leggero);
  padding: var(--spazio-md);
}

.dg-skel {
  background: linear-gradient(90deg, #eee 25%, #f6f6f6 37%, #eee 63%);
  background-size: 400% 100%;
  animation: dg-skel 1.2s ease infinite;
  border-radius: 8px;
}
@keyframes dg-skel {
  0% { background-position: 100% 50%; }
  100% { background-position: 0 50%; }
}

/* ---------- 13.6 Gate interazione (blur + overlay) ---------- */
.dg--locked .dg-grid {
  filter: blur(2px) grayscale(.2);
  pointer-events: none;
}
.dg__overlay {
  position: relative;
}
.dg__overlay::after {
  content: 'Accedi per cercare e visualizzare gli altri autori';
  position: absolute; inset: 0;
  display: grid; place-items: center;
  padding: var(--spazio-md);
  color: var(--c-testo);
  background: linear-gradient( to bottom, rgba(255,255,255,.85), rgba(255,255,255,.85) );
  border: 2px dashed var(--c-bordi);
  border-radius: 12px;
  text-align: center;
  font-weight: 700;
}

/* ---------- 13.7 Preferenze utente / riduzione movimento ---------- */
@media (prefers-reduced-motion: reduce){
  .dg-card, .dg-details { transition: none !important; }
}

/* ---------- 13.8 Dark mode opzionale ---------- */
@media (prefers-color-scheme: dark){
  .dg { background: #101213; border-color: #2a2d30; }
  .dg__banner { background: #0c0d0f; border-color: #2a2d30; }
  .dg__banner .dg__cta { background: #0c0d0f; border-color: #2a2d30; color: #c7d0d9; }
  .dg__banner .dg__cta:hover { border-color: var(--c-primario); color: var(--c-primario); }

  .dg__search, .dg__select { background: #0c0d0f; border-color: #2a2d30; color: #e9eef2; }
  .dg-card { background: #0c0d0f; border-color: #2a2d30; }
  .dg-card--owner { box-shadow: 0 0 0 3px rgba(61, 140, 64, .35); }
  .dg-card__id, .dg-meta__pill, .dg-tag { color: #9aa3ab; border-color: #2a2d30; background: #0c0d0f; }
  .dg-card__footer { border-top-color: #2a2d30; }
  .dg-btn { background: #0c0d0f; border-color: #2a2d30; color: #c7d0d9; }
  .dg-empty, .dg-error { border-color: #2a2d30; color: #9aa3ab; }
  .dg__overlay::after { background: linear-gradient(to bottom, rgba(12,13,15,.9), rgba(12,13,15,.9)); color: #c7d0d9; }
}
